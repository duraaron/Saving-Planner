(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{230:(e,t,r)=>{Promise.resolve().then(r.bind(r,3503))},3503:(e,t,r)=>{"use strict";let a,n,s;r.d(t,{SavingPlannerDemo:()=>ew});var i=r(5155),l=r(2115),o=r(4827),c=r(6037);let d="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs";class u{isLoaded(){return y(window,this._trace)}load(){if(console.log("[RelayerSDKLoader] load..."),"relayerSDK"in window){if(!p(window.relayerSDK,this._trace))throw console.log("[RelayerSDKLoader] window.relayerSDK === undefined"),Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return Promise.resolve()}return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(d,'"]'))){y(window,this._trace)||t(Error("RelayerSDKLoader: window object does not contain a valid relayerSDK object.")),e();return}let r=document.createElement("script");r.src=d,r.type="text/javascript",r.async=!0,r.onload=()=>{y(window,this._trace)||(console.log("[RelayerSDKLoader] script onload FAILED..."),t(Error("RelayerSDKLoader: Relayer SDK script has been successfully loaded from ".concat(d,", however, the window.relayerSDK object is invalid.")))),e()},r.onerror=()=>{console.log("[RelayerSDKLoader] script onerror... "),t(Error("RelayerSDKLoader: Failed to load Relayer SDK from ".concat(d)))},console.log("[RelayerSDKLoader] add script to DOM..."),document.head.appendChild(r),console.log("[RelayerSDKLoader] script added!")})}constructor(e){this._trace=e.trace}}function p(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: relayerSDK is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: relayerSDK is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: relayerSDK is not an object"),!1):m(e,"initSDK","function",t)?m(e,"createInstance","function",t)?m(e,"SepoliaConfig","object",t)?!("__initialized__"in e)||!0===e.__initialized__||!1===e.__initialized__||(null==t||t("RelayerSDKLoader: relayerSDK.__initialized__ is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function y(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: window object is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: window object is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: window is not an object"),!1):"relayerSDK"in e?p(e.relayerSDK):(null==t||t("RelayerSDKLoader: window does not contain 'relayerSDK' property"),!1)}function m(e,t,r,a){if(!e||"object"!=typeof e)return!1;if(!(t in e))return null==a||a("RelayerSDKLoader: missing ".concat(String(t),".")),!1;let n=e[t];return null==n?(null==a||a("RelayerSDKLoader: ".concat(String(t)," is null or undefined.")),!1):typeof n===r||(null==a||a("RelayerSDKLoader: ".concat(String(t)," is not a ").concat(r,".")),!1)}let h=(e,t)=>t.some(t=>e instanceof t),g=new WeakMap,x=new WeakMap,v=new WeakMap,f={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return g.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return b(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function b(e){if(e instanceof IDBRequest){let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("success",n),e.removeEventListener("error",s)},n=()=>{t(b(e.result)),a()},s=()=>{r(e.error),a()};e.addEventListener("success",n),e.addEventListener("error",s)});return v.set(t,e),t}if(x.has(e))return x.get(e);let t=function(e){if("function"==typeof e)return(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(w(this),t),b(this.request)}:function(...t){return b(e.apply(w(this),t))};return(e instanceof IDBTransaction&&function(e){if(g.has(e))return;let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",s),e.removeEventListener("abort",s)},n=()=>{t(),a()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",n),e.addEventListener("error",s),e.addEventListener("abort",s)});g.set(e,t)}(e),h(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,f):e}(e);return t!==e&&(x.set(e,t),v.set(t,e)),t}let w=e=>v.get(e),S=["get","getKey","getAll","getAllKeys","count"],j=["put","add","delete","clear"],D=new Map;function N(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(D.get(t))return D.get(t);let r=t.replace(/FromIndex$/,""),a=t!==r,n=j.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||S.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,n?"readwrite":"readonly"),i=s.store;return a&&(i=i.index(t.shift())),(await Promise.all([i[r](...t),n&&s.done]))[0]};return D.set(t,s),s}f=(e=>({...e,get:(t,r,a)=>N(t,r)||e.get(t,r,a),has:(t,r)=>!!N(t,r)||e.has(t,r)}))(f);let K=["continue","continuePrimaryKey","advance"],_={},I=new WeakMap,E=new WeakMap,A={get(e,t){if(!K.includes(t))return e[t];let r=_[t];return r||(r=_[t]=function(...e){I.set(this,E.get(this)[t](...e))}),r}};async function*P(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let r=new Proxy(t,A);for(E.set(r,t),v.set(r,w(t));t;)yield r,t=await (I.get(r)||t.continue()),I.delete(r)}function R(e,t){return t===Symbol.asyncIterator&&h(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&h(e,[IDBIndex,IDBObjectStore])}async function C(){return s||(s=function(e,t,{blocked:r,upgrade:a,blocking:n,terminated:s}={}){let i=indexedDB.open(e,1),l=b(i);return a&&i.addEventListener("upgradeneeded",e=>{a(b(i.result),e.oldVersion,e.newVersion,b(i.transaction),e)}),r&&i.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),l.then(e=>{s&&e.addEventListener("close",()=>s()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),l}("fhevm",0,{upgrade(e){e.objectStoreNames.contains("paramsStore")||e.createObjectStore("paramsStore",{keyPath:"acl"}),e.objectStoreNames.contains("publicKeyStore")||e.createObjectStore("publicKeyStore",{keyPath:"acl"})}}))}function k(e){if("object"!=typeof e)throw Error("FhevmStoredPublicKey must be an object");if(null!==e){if(!("publicKeyId"in e))throw Error("FhevmStoredPublicKey.publicKeyId does not exist");if("string"!=typeof e.publicKeyId)throw Error("FhevmStoredPublicKey.publicKeyId must be a string");if(!("publicKey"in e))throw Error("FhevmStoredPublicKey.publicKey does not exist");if(!(e.publicKey instanceof Uint8Array))throw Error("FhevmStoredPublicKey.publicKey must be a Uint8Array")}}function T(e){if("object"!=typeof e)throw Error("FhevmStoredPublicParams must be an object");if(null!==e){if(!("publicParamsId"in e))throw Error("FhevmStoredPublicParams.publicParamsId does not exist");if("string"!=typeof e.publicParamsId)throw Error("FhevmStoredPublicParams.publicParamsId must be a string");if(!("publicParams"in e))throw Error("FhevmStoredPublicParams.publicParams does not exist");if(!(e.publicParams instanceof Uint8Array))throw Error("FhevmStoredPublicParams.publicParams must be a Uint8Array")}}async function M(e){let t,r=await C();if(!r)return{publicParams:null};let a=null;try{let t=await r.get("publicKeyStore",e);(null==t?void 0:t.value)&&(k(t.value),a=t.value)}catch(e){}let n=null;try{let t=await r.get("paramsStore",e);(null==t?void 0:t.value)&&(T(t.value),n=t.value)}catch(e){}let s=null==a?void 0:a.publicKey,i=null==a?void 0:a.publicKeyId,l=n?{2048:n}:null;return i&&s&&(t={id:i,data:s}),{...void 0!==t&&{publicKey:t},publicParams:l}}async function L(e,t,r){k(t),T(r);let a=await C();a&&(t&&await a.put("publicKeyStore",{acl:e,value:t}),r&&await a.put("paramsStore",{acl:e,value:r}))}f=(e=>({...e,get:(t,r,a)=>R(t,r)?P:e.get(t,r,a),has:(t,r)=>R(t,r)||e.has(t,r)}))(f);class F extends Error{constructor(e,t,r){super(t,r),this.code=e,this.name="FhevmReactError"}}function V(e,t,r){throw new F(e,t,r?{cause:r}:void 0)}let W=async e=>{if(!y(window,console.log))throw Error("window.relayerSDK is not available");let t=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=t,!t)throw Error("window.relayerSDK.initSDK failed.");return!0};class B extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function O(e){if("string"==typeof e){let t=new c.FR(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function q(e){let t=new c.FR(e);try{return await t.send("web3_clientVersion",[])}catch(t){V("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function H(e){let t=await q(e);if("string"==typeof t&&t.toLowerCase().includes("hardhat"))try{let t=await U(e);if(!t||"object"!=typeof t||!("ACLAddress"in t&&"string"==typeof t.ACLAddress&&t.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in t&&"string"==typeof t.InputVerifierAddress&&t.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in t&&"string"==typeof t.KMSVerifierAddress&&t.KMSVerifierAddress.startsWith("0x")))return;return t}catch(e){return}}async function U(e){let t=new c.FR(e);try{return await t.send("fhevm_relayer_metadata",[])}catch(t){V("FHEVM_RELAYER_METADATA_ERROR","The URL ".concat(e," is not a FHEVM Hardhat node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function z(e,t){let r=await O(e),a="string"==typeof e?e:void 0,n={31337:"http://localhost:8545",...null!=t?t:{}};return Object.hasOwn(n,r)?(a||(a=n[r]),{isMock:!0,chainId:r,rpcUrl:a}):{isMock:!1,chainId:r,rpcUrl:a}}let G=async e=>{let t=()=>{if(n.aborted)throw new B},a=e=>{s&&s(e)},{signal:n,onStatusChange:s,provider:i,mockChains:l}=e,{isMock:c,rpcUrl:d,chainId:p}=await z(i,l);if(c){let e=await H(d);if(e){a("creating");let n=await Promise.all([r.e(235),r.e(79)]).then(r.bind(r,7079)),s=await n.fhevmMockCreateInstance({rpcUrl:d,chainId:p,metadata:e});return t(),s}}t(),y(window,console.log)||(a("sdk-loading"),await new u({trace:console.log}).load(),t(),a("sdk-loaded")),y(window,console.log)&&!0===window.relayerSDK.__initialized__||(a("sdk-initializing"),await W(),t(),a("sdk-initialized"));let m=window.relayerSDK,h=m.SepoliaConfig.aclContractAddress;if(!function(e){return"string"==typeof e&&!!(0,o.PW)(e)}(h))throw Error("Invalid address: ".concat(h));let g=await M(h);t();let x={...m.SepoliaConfig,network:i,publicKey:g.publicKey,publicParams:g.publicParams};a("creating");let v=await m.createInstance(x);return await L(h,v.getPublicKey(),v.getPublicParams(2048)),t(),v};function Y(e,t){if(!e){let e=t?"Assertion failed: ".concat(t):"Assertion failed.";throw console.error(e),Error(e)}}var J=r(8814),Z=r(557),$=r(2127),Q=r(9353),X=r(3338),ee=r(7325),et=r(5777),er=r(5378),ea=r(2507);function en(){return Math.floor(Date.now()/1e3)}var es=new WeakMap,ei=new WeakMap,el=new WeakMap,eo=new WeakMap;class ec{get contractAddresses(){return(0,ee._)(this,es)}get userAddress(){return(0,ee._)(this,ei)}get publicKey(){return(0,ee._)(this,el)}get key(){return(0,ee._)(this,eo)}constructor(e,t,r,a){if((0,et._)(this,es,{writable:!0,value:void 0}),(0,et._)(this,ei,{writable:!0,value:void 0}),(0,et._)(this,el,{writable:!0,value:void 0}),(0,et._)(this,eo,{writable:!0,value:void 0}),!o.PW(r))throw TypeError("Invalid address ".concat(r));let n=t.sort(),s=e.createEIP712(null!=a?a:$.j,n,0,0);try{let e=ea.z.hash(s.domain,{UserDecryptRequestVerification:s.types.UserDecryptRequestVerification},s.message);(0,er._)(this,es,n),(0,er._)(this,ei,r),(0,er._)(this,eo,"".concat(r,":").concat(e))}catch(e){throw console.log(e),e}}}var ed=new WeakMap,eu=new WeakMap,ep=new WeakMap,ey=new WeakMap,em=new WeakMap,eh=new WeakMap,eg=new WeakMap,ex=new WeakMap;class ev{get privateKey(){return(0,ee._)(this,eu)}get publicKey(){return(0,ee._)(this,ed)}get signature(){return(0,ee._)(this,ep)}get contractAddresses(){return(0,ee._)(this,eg)}get startTimestamp(){return(0,ee._)(this,ey)}get durationDays(){return(0,ee._)(this,em)}get userAddress(){return(0,ee._)(this,eh)}static checkIs(e){if(!e||"object"!=typeof e||!("publicKey"in e&&"string"==typeof e.publicKey)||!("privateKey"in e&&"string"==typeof e.privateKey)||!("signature"in e&&"string"==typeof e.signature)||!("startTimestamp"in e&&"number"==typeof e.startTimestamp)||!("durationDays"in e&&"number"==typeof e.durationDays)||!("contractAddresses"in e&&Array.isArray(e.contractAddresses)))return!1;for(let t=0;t<e.contractAddresses.length;++t)if("string"!=typeof e.contractAddresses[t]||!e.contractAddresses[t].startsWith("0x"))return!1;return!!("userAddress"in e&&"string"==typeof e.userAddress&&e.userAddress.startsWith("0x"))&&!!("eip712"in e&&"object"==typeof e.eip712&&null!==e.eip712)&&!!("domain"in e.eip712&&"object"==typeof e.eip712.domain)&&!!("primaryType"in e.eip712&&"string"==typeof e.eip712.primaryType)&&"message"in e.eip712&&!!("types"in e.eip712&&"object"==typeof e.eip712.types&&null!==e.eip712.types)}toJSON(){return{publicKey:(0,ee._)(this,ed),privateKey:(0,ee._)(this,eu),signature:(0,ee._)(this,ep),startTimestamp:(0,ee._)(this,ey),durationDays:(0,ee._)(this,em),userAddress:(0,ee._)(this,eh),contractAddresses:(0,ee._)(this,eg),eip712:(0,ee._)(this,ex)}}static fromJSON(e){return new ev("string"==typeof e?JSON.parse(e):e)}equals(e){return e.signature===(0,ee._)(this,ep)}isValid(){return en()<(0,ee._)(this,ey)+24*(0,ee._)(this,em)*3600}async saveToGenericStringStorage(e,t,r){try{let a=JSON.stringify(this),n=new ec(t,(0,ee._)(this,eg),(0,ee._)(this,eh),r?(0,ee._)(this,ed):void 0);await e.setItem(n.key,a),console.log("signature saved! contracts=".concat((0,ee._)(this,eg).length))}catch(e){console.error("FhevmDecryptionSignature.saveToGenericStringStorage() failed!")}}static async loadFromGenericStringStorage(e,t,r,a,n){try{let s=new ec(t,r,a,n),i=await e.getItem(s.key);if(!i)return console.warn("Could not load signature! key=".concat(s.key)),null;try{let e=ev.fromJSON(i);if(!e.isValid())return null;return e}catch(e){return null}}catch(e){return console.error("FhevmDecryptionSignature.loadFromGenericStringStorage() failed!"),null}}static async new(e,t,r,a,n){try{let s=await n.getAddress(),i=en(),l=e.createEIP712(r,t,i,365),o=await n.signTypedData(l.domain,{UserDecryptRequestVerification:l.types.UserDecryptRequestVerification},l.message);return new ev({publicKey:r,privateKey:a,contractAddresses:t,startTimestamp:i,durationDays:365,signature:o,eip712:l,userAddress:s})}catch(e){return null}}static async loadOrSign(e,t,r,a,n){let s=await r.getAddress(),i=await ev.loadFromGenericStringStorage(a,e,t,s,null==n?void 0:n.publicKey);if(i)return i;let{publicKey:l,privateKey:o}=null!=n?n:e.generateKeypair(),c=await ev.new(e,t,l,o,r);return c?(await c.saveToGenericStringStorage(a,e,!!(null==n?void 0:n.publicKey)),c):null}constructor(e){if((0,et._)(this,ed,{writable:!0,value:void 0}),(0,et._)(this,eu,{writable:!0,value:void 0}),(0,et._)(this,ep,{writable:!0,value:void 0}),(0,et._)(this,ey,{writable:!0,value:void 0}),(0,et._)(this,em,{writable:!0,value:void 0}),(0,et._)(this,eh,{writable:!0,value:void 0}),(0,et._)(this,eg,{writable:!0,value:void 0}),(0,et._)(this,ex,{writable:!0,value:void 0}),!ev.checkIs(e))throw TypeError("Invalid FhevmDecryptionSignatureType");(0,er._)(this,ed,e.publicKey),(0,er._)(this,eu,e.privateKey),(0,er._)(this,ep,e.signature),(0,er._)(this,ey,e.startTimestamp),(0,er._)(this,em,e.durationDays),(0,er._)(this,eh,e.userAddress),(0,er._)(this,eg,e.contractAddresses),(0,er._)(this,ex,e.eip712)}}let ef={0xaa36a7:{address:"0x3eA25f2b974142F5991418B5Fb410b93a24A16b3",chainId:0xaa36a7,chainName:"sepolia"}},eb={abi:[{inputs:[],name:"ZamaProtocolUnsupported",type:"error"},{inputs:[],name:"confidentialProtocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"userAddress",type:"address"}],name:"getAchievability",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"userAddress",type:"address"}],name:"getCurrentSaving",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"userAddress",type:"address"}],name:"getRate",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"userAddress",type:"address"}],name:"getRequiredSaving",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"userAddress",type:"address"}],name:"getTarget",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"userAddress",type:"address"}],name:"getTime",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"recalculateSavingsPlan",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"annualRateScaled6",type:"uint32"},{internalType:"uint32",name:"months",type:"uint32"}],name:"recalculateSavingsPlanWithParams",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"externalEuint32",name:"encryptedTarget",type:"bytes32"},{internalType:"externalEuint32",name:"encryptedRate",type:"bytes32"},{internalType:"externalEuint32",name:"encryptedTime",type:"bytes32"},{internalType:"externalEuint32",name:"encryptedCurrentSaving",type:"bytes32"},{internalType:"bytes",name:"inputProof",type:"bytes"},{internalType:"uint32",name:"annualRateScaled6",type:"uint32"},{internalType:"uint32",name:"months",type:"uint32"}],name:"submitSavingsPlan",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"userSavingsData",outputs:[{internalType:"euint32",name:"target",type:"bytes32"},{internalType:"euint32",name:"rate",type:"bytes32"},{internalType:"euint32",name:"time",type:"bytes32"},{internalType:"euint32",name:"currentSaving",type:"bytes32"},{internalType:"euint32",name:"requiredSaving",type:"bytes32"},{internalType:"euint32",name:"achievability",type:"bytes32"}],stateMutability:"view",type:"function"}]},ew=()=>{var e,t;let{storage:r}=(0,J.p)(),{provider:a,chainId:n,accounts:s,isConnected:o,connect:c,ethersSigner:d,ethersReadonlyProvider:u,sameChain:p,sameSigner:y,initialMockChains:m}=(0,Z.z)(),{instance:h,status:g,error:x}=function(e){let{provider:t,chainId:r,initialMockChains:a,enabled:n=!0}=e,[s,i]=(0,l.useState)(void 0),[o,c]=(0,l.useState)("idle"),[d,u]=(0,l.useState)(void 0),[p,y]=(0,l.useState)(n),[m,h]=(0,l.useState)(0),g=(0,l.useRef)(null),x=(0,l.useRef)(t),v=(0,l.useRef)(r),f=(0,l.useRef)(a),b=(0,l.useCallback)(()=>{g.current&&(x.current=void 0,v.current=void 0,g.current.abort(),g.current=null),x.current=t,v.current=r,i(void 0),u(void 0),c("idle"),void 0!==t&&h(e=>e+1)},[t,r]);return(0,l.useEffect)(()=>{b()},[b]),(0,l.useEffect)(()=>{y(n)},[n]),(0,l.useEffect)(()=>{if(!1===p){console.log("cancelled"),g.current&&(g.current.abort(),g.current=null),i(void 0),u(void 0),c("idle");return}if(!0===p){if(void 0===x.current){i(void 0),u(void 0),c("idle");return}g.current||(g.current=new AbortController),Y(!g.current.signal.aborted,"!controllerRef.current.signal.aborted"),c("loading"),u(void 0);let e=g.current.signal,t=x.current;G({signal:e,provider:t,mockChains:f.current,onStatusChange:e=>console.log("[useFhevm] createFhevmInstance status changed: ".concat(e))}).then(r=>{console.log("[useFhevm] createFhevmInstance created!"),e.aborted||(Y(t===x.current,"thisProvider === _providerRef.current"),i(r),u(void 0),c("ready"))}).catch(r=>{console.log("Error Was thrown !!! error... "+r.name),e.aborted||(Y(t===x.current,"thisProvider === _providerRef.current"),i(void 0),u(r),c("error"))})}},[p,m]),{instance:s,refresh:b,error:d,status:o}}({provider:a,chainId:n,initialMockChains:m,enabled:!0}),v=(e=>{let{instance:t,fhevmDecryptionSignatureStorage:r,chainId:a,ethersSigner:n,ethersReadonlyProvider:s,sameChain:i,sameSigner:o}=e,[c,d]=(0,l.useState)(void 0),[u,p]=(0,l.useState)(void 0),[y,m]=(0,l.useState)(void 0),[h,g]=(0,l.useState)(void 0),[x,v]=(0,l.useState)(void 0),[f,b]=(0,l.useState)(void 0),[w,S]=(0,l.useState)({}),[j,D]=(0,l.useState)(!1),[N,K]=(0,l.useState)(!1),[_,I]=(0,l.useState)(!1),[E,A]=(0,l.useState)(""),P=(0,l.useRef)(void 0),R=(0,l.useRef)(j),C=(0,l.useRef)(N),k=(0,l.useRef)(_),T=(0,l.useMemo)(()=>{let e=function(e){var t;if(!e)return{abi:eb.abi};let r=ef[e.toString()];return"address"in r&&r.address!==$.j?{address:null==r?void 0:r.address,chainId:null!=(t=null==r?void 0:r.chainId)?t:e,chainName:null==r?void 0:r.chainName,abi:eb.abi}:{abi:eb.abi,chainId:e}}(a);return P.current=e,a&&!e.address?A("SavingPlanner deployment not found for chainId=".concat(a,".")):A(""),e},[a]),M=(0,l.useMemo)(()=>{if(T)return!!T.address&&T.address!==$.j},[T]),L=(0,l.useMemo)(()=>T.address&&t&&n&&!j&&!N,[T.address,t,n,j,N]),F=(0,l.useMemo)(()=>T.address&&t&&n&&!j&&!_&&(x||f)&&x!==Q.p&&f!==Q.p,[T.address,t,n,j,_,x,f]),V=(0,l.useCallback)(()=>{var e,t;if(console.log("[useSavingPlanner] call refreshData()"),R.current)return;if(!P.current||!(null==(e=P.current)?void 0:e.chainId)||!(null==(t=P.current)?void 0:t.address)||!s){d(void 0),p(void 0),m(void 0),g(void 0),v(void 0),b(void 0);return}R.current=!0,D(!0);let r=P.current.chainId,a=P.current.address,l=new X.NZ(a,P.current.abi,s);Promise.all([l.getRequiredSaving((null==n?void 0:n.address)||$.j),l.getAchievability((null==n?void 0:n.address)||$.j)]).then(e=>{var t;let[n,s]=e;console.log("[useSavingPlanner] getRequiredSaving()="+n),console.log("[useSavingPlanner] getAchievability()="+s),i.current(r)&&a===(null==(t=P.current)?void 0:t.address)&&(v(n),b(s)),R.current=!1,D(!1)}).catch(e=>{A("SavingPlanner.getRequiredSaving() or getAchievability() call failed! error="+e),R.current=!1,D(!1)})},[s,null==n?void 0:n.address,i]);(0,l.useEffect)(()=>{V()},[V]);let W=(0,l.useCallback)(e=>{if(R.current||C.current||!T.address||!t||!n)return;let r=T.address,s=new X.NZ(r,T.abi,n);C.current=!0,K(!0),A("Starting encryption and submission..."),(async()=>{await new Promise(e=>setTimeout(e,100));let l=()=>{var e;return r!==(null==(e=P.current)?void 0:e.address)||!i.current(a)||!o.current(n)};try{let a=t.createEncryptedInput(r,n.address);a.add32(e.target),a.add32(e.rate),a.add32(e.time),a.add32(e.currentSaving),A("Encrypting data...");let i=await a.encrypt();if(l())return void A("Ignore submission");A("Submitting to contract...");let o=Math.round(100*Number(e.rate)),c=Number(e.time),d=await s.submitSavingsPlan(i.handles[0],i.handles[1],i.handles[2],i.handles[3],i.inputProof,o,c);A("Wait for tx:".concat(d.hash,"..."));let u=await d.wait();if(A("Submission completed status=".concat(null==u?void 0:u.status)),l())return void A("Ignore submission");V()}catch(e){A("Submission failed! Error: ".concat(e))}finally{C.current=!1,K(!1)}})()},[n,T.address,T.abi,t,a,V,i,o]),B=(0,l.useCallback)(()=>{if(R.current||k.current||!T.address||!t||!n)return;if(!x&&!f)return void S({});let e=T.address;k.current=!0,I(!0),A("Start decrypt..."),(async()=>{let s=()=>{var t;return e!==(null==(t=P.current)?void 0:t.address)||!i.current(a)||!o.current(n)};try{let a=await ev.loadOrSign(t,[T.address],n,r);if(!a)return void A("Unable to build FHEVM decryption signature");if(s())return void A("Ignore FHEVM decryption");A("Call FHEVM userDecrypt...");let i=[];if(x&&x!==Q.p&&i.push({handle:x,contractAddress:e}),f&&f!==Q.p&&i.push({handle:f,contractAddress:e}),0===i.length)return void A("No handles to decrypt");let l=await t.userDecrypt(i,a.privateKey,a.publicKey,a.signature,a.contractAddresses,a.userAddress,a.startTimestamp,a.durationDays);if(A("FHEVM userDecrypt completed!"),s())return void A("Ignore FHEVM decryption");let o=e=>{if("bigint"==typeof e)return e;if("string"==typeof e)try{return BigInt(e)}catch(e){}};S({requiredSaving:x?o(l[x]):void 0,achievability:f?o(l[f]):void 0}),A("Decryption completed successfully!")}finally{k.current=!1,I(!1)}})()},[r,n,T.address,t,x,f,a,i,o]);return{contractAddress:T.address,canSubmit:L,canDecrypt:F,submitSavingsPlan:W,decryptResults:B,refreshData:V,message:E,decryptedResults:w,isSubmitting:N,isDecrypting:_,isRefreshing:j,isDeployed:M}})({instance:h,fhevmDecryptionSignatureStorage:r,eip1193Provider:a,chainId:n,ethersSigner:d,ethersReadonlyProvider:u,sameChain:p,sameSigner:y}),[f,b]=(0,l.useState)(""),[w,S]=(0,l.useState)(""),[j,D]=(0,l.useState)(""),[N,K]=(0,l.useState)("");return o?"number"!=typeof n||v.contractAddress?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("div",{className:"glass-card rounded-2xl p-8 hover-lift",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-3xl font-bold text-white mb-2",children:"Encrypted Savings Calculator"}),(0,i.jsx)("p",{className:"text-gray-300 text-lg",children:"Calculate your monthly savings goal with complete privacy using FHE technology"}),(0,i.jsx)("div",{className:"mt-4 inline-block",children:(0,i.jsx)("span",{className:"status-badge info",children:(0,i.jsxs)("span",{className:"font-mono text-xs",children:[null==(e=v.contractAddress)?void 0:e.slice(0,10),"...",null==(t=v.contractAddress)?void 0:t.slice(-8)]})})})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("p",{className:"text-sm text-gray-400 uppercase tracking-wide mb-1",children:"Network"}),(0,i.jsxs)("div",{className:"status-badge success",children:["Chain ID: ",n]})]})]})}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"glass-card rounded-2xl p-6 hover-lift",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,i.jsx)("div",{className:"w-10 h-10 rounded-lg gradient-green flex items-center justify-center text-xl",children:"\uD83D\uDD12"}),(0,i.jsx)("h3",{className:"text-xl font-bold text-white",children:"FHEVM Engine"})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)(eS,{label:"Instance Status",value:h?"Ready":"Initializing",status:h?"success":"warning"}),(0,i.jsx)(eS,{label:"Connection",value:g,status:"info"}),(0,i.jsx)(eS,{label:"Error State",value:x?x instanceof Error?x.message:x:"No Errors",status:x?"warning":"success"})]})]}),(0,i.jsxs)("div",{className:"glass-card rounded-2xl p-6 hover-lift",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,i.jsx)("div",{className:"w-10 h-10 rounded-lg gradient-orange flex items-center justify-center text-xl",children:"⚡"}),(0,i.jsx)("h3",{className:"text-xl font-bold text-white",children:"Operation Status"})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)(eS,{label:"Can Submit",value:v.canSubmit,status:v.canSubmit?"success":"warning"}),(0,i.jsx)(eS,{label:"Submitting",value:v.isSubmitting,status:v.isSubmitting?"warning":"info"}),(0,i.jsx)(eS,{label:"Can Decrypt",value:v.canDecrypt,status:v.canDecrypt?"success":"warning"}),(0,i.jsx)(eS,{label:"Decrypting",value:v.isDecrypting,status:v.isDecrypting?"warning":"info"})]})]})]}),(0,i.jsxs)("div",{className:"glass-card rounded-2xl p-8 hover-lift",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,i.jsx)("div",{className:"w-10 h-10 rounded-lg gradient-green flex items-center justify-center text-xl",children:"\uD83D\uDCCA"}),(0,i.jsx)("h3",{className:"text-2xl font-bold text-white",children:"Calculate Your Savings Plan"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsx)(ej,{label:"Savings Target",value:f,onChange:b,placeholder:"e.g., 100000",description:"Your total savings goal amount",icon:"\uD83C\uDFAF"}),(0,i.jsx)(ej,{label:"Annual Interest Rate",value:w,onChange:S,placeholder:"e.g., 500 (=5%)",description:"Rate in basis points (500 = 5%)",icon:"\uD83D\uDCC8"}),(0,i.jsx)(ej,{label:"Time Period",value:j,onChange:D,placeholder:"e.g., 12",description:"Number of months to reach goal",icon:"\uD83D\uDCC5"}),(0,i.jsx)(ej,{label:"Current Savings",value:N,onChange:K,placeholder:"e.g., 10000",description:"Your existing savings amount",icon:"\uD83D\uDCB5"})]}),(0,i.jsx)("div",{className:"mt-8 flex justify-center",children:(0,i.jsx)("button",{className:"gradient-green hover:opacity-90 active:scale-95 px-10 py-4 rounded-xl font-bold text-white text-lg shadow-2xl transition-all duration-200 \n              ".concat(v.canSubmit?"":"opacity-50 cursor-not-allowed"),disabled:!v.canSubmit,onClick:()=>{let e=parseInt(f),t=parseInt(w),r=parseInt(j),a=parseInt(N);return isNaN(e)||isNaN(t)||isNaN(r)||isNaN(a)?void alert("Please enter valid numbers for all fields"):e<=0||t<0||r<=0||a<0?void alert("Please enter positive values"):void v.submitSavingsPlan({target:e,rate:t,time:r,currentSaving:a})},children:v.canSubmit?"\uD83D\uDD10 Calculate Encrypted Savings Plan":v.isSubmitting?"⏳ Processing Transaction...":"⚠️ Please Check Input Values"})})]}),(0,i.jsxs)("div",{className:"glass-card rounded-2xl p-8 hover-lift",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,i.jsx)("div",{className:"w-10 h-10 rounded-lg gradient-orange flex items-center justify-center text-xl",children:"\uD83D\uDD13"}),(0,i.jsx)("h3",{className:"text-2xl font-bold text-white",children:"Decrypted Results"})]}),(0,i.jsx)("div",{className:"bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-xl p-6 mb-6 border border-blue-700/50",children:(0,i.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,i.jsx)("div",{className:"text-4xl",children:"\uD83D\uDCB0"}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("p",{className:"text-sm text-gray-400 uppercase tracking-wide mb-2",children:"Required Monthly Payment"}),(0,i.jsx)("p",{className:"text-4xl font-bold text-white mb-3",children:void 0!==v.decryptedResults.requiredSaving?"$".concat((Number(v.decryptedResults.requiredSaving)/1e3).toFixed(3)):"Awaiting Decryption"}),(0,i.jsxs)("div",{className:"bg-black/30 rounded-lg p-4 border border-gray-700/50",children:[(0,i.jsxs)("p",{className:"text-sm text-gray-300 leading-relaxed",children:[(0,i.jsx)("span",{className:"font-semibold text-white",children:"How it works:"})," This is the monthly amount you need to save to reach your target, factoring in compound interest."]}),(0,i.jsxs)("p",{className:"text-xs text-gray-400 mt-3 font-mono",children:[(0,i.jsx)("span",{className:"text-white",children:"Formula:"})," payment = (target - current \xd7 (1 + i)^m) \xd7 i \xf7 ((1 + i)^m - 1)",(0,i.jsx)("br",{}),(0,i.jsx)("span",{className:"text-gray-500",children:"where i = annual_rate \xf7 12, m = months"})]}),(0,i.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:[(0,i.jsx)("span",{className:"text-yellow-400",children:"⚠️ Special Case:"})," If interest rate is 0%, formula simplifies to: (target - current) \xf7 months"]})]})]})]})}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)("button",{className:"gradient-orange hover:opacity-90 active:scale-95 px-10 py-4 rounded-xl font-bold text-white text-lg shadow-2xl transition-all duration-200\n              ".concat(v.canDecrypt?"":"opacity-50 cursor-not-allowed"),disabled:!v.canDecrypt,onClick:v.decryptResults,children:v.canDecrypt?"\uD83D\uDD13 Decrypt & Reveal Results":v.isDecrypting?"⏳ Decrypting Data...":"\uD83D\uDCED No Data to Decrypt"})})]}),v.message&&(0,i.jsx)("div",{className:"glass-card rounded-2xl p-6 border-l-4 border-blue-400",children:(0,i.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,i.jsx)("div",{className:"text-2xl",children:"\uD83D\uDCAC"}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("p",{className:"text-sm text-gray-400 uppercase tracking-wide mb-1",children:"System Message"}),(0,i.jsx)("p",{className:"text-white font-medium",children:v.message})]})]})})]}):function(e){return(0,i.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,i.jsxs)("div",{className:"glass-card rounded-3xl p-12 max-w-3xl",children:[(0,i.jsxs)("div",{className:"text-center mb-8",children:[(0,i.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full gradient-orange flex items-center justify-center text-5xl shadow-2xl animate-pulse-slow",children:"⚠️"}),(0,i.jsx)("h2",{className:"text-4xl font-bold text-white mb-4",children:"Contract Not Deployed"}),(0,i.jsx)("div",{className:"inline-block px-4 py-2 rounded-lg bg-red-900/30 border border-red-700/50 mb-6",children:(0,i.jsxs)("p",{className:"text-red-300 font-mono",children:["SavingPlanner.sol not found on Chain ID: ",e," ",0xaa36a7===e?"(Sepolia)":""]})})]}),(0,i.jsxs)("div",{className:"space-y-6 text-left",children:[(0,i.jsx)("div",{className:"glass-card-light rounded-xl p-6",children:(0,i.jsxs)("div",{className:"flex items-start space-x-3 mb-4",children:[(0,i.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCCB"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:"Issue Details"}),(0,i.jsxs)("p",{className:"text-gray-300 leading-relaxed",children:["The ",(0,i.jsx)("span",{className:"font-mono text-green-400",children:"SavingPlanner.sol"})," contract has not been deployed, or the deployment address is missing from the ABI directory"," ",(0,i.jsx)("span",{className:"font-mono text-orange-400",children:"frontend/abi"}),"."]})]})]})}),(0,i.jsx)("div",{className:"glass-card-light rounded-xl p-6",children:(0,i.jsxs)("div",{className:"flex items-start space-x-3 mb-4",children:[(0,i.jsx)("span",{className:"text-2xl",children:"\uD83D\uDD27"}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-white mb-3",children:"Deployment Instructions"}),(0,i.jsx)("p",{className:"text-gray-300 mb-4",children:"To deploy the contract on a local Hardhat node, run:"}),(0,i.jsxs)("div",{className:"bg-black/50 rounded-lg p-4 border border-gray-700/50",children:[(0,i.jsx)("p",{className:"text-gray-500 text-sm italic mb-1",children:"# from SavingPlanner/backend"}),(0,i.jsx)("p",{className:"font-mono text-green-400 text-lg",children:"npx hardhat deploy --network hardhat"})]})]})]})}),(0,i.jsx)("div",{className:"glass-card-light rounded-xl p-6",children:(0,i.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,i.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCA1"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:"Alternative Solution"}),(0,i.jsxs)("p",{className:"text-gray-300 leading-relaxed",children:["You can also switch to the local ",(0,i.jsx)("span",{className:"font-mono text-blue-400",children:"Hardhat Node"})," using the MetaMask browser extension."]})]})]})})]})]})})}(n):(0,i.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,i.jsx)("div",{className:"text-center",children:(0,i.jsxs)("div",{className:"glass-card rounded-3xl p-12 hover-lift",children:[(0,i.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full gradient-orange flex items-center justify-center text-5xl shadow-2xl",children:"\uD83D\uDD10"}),(0,i.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Connect Your Wallet"}),(0,i.jsx)("p",{className:"text-gray-300 mb-8 text-lg",children:"Connect MetaMask to start planning your encrypted savings journey"}),(0,i.jsx)("button",{className:"gradient-green hover:opacity-90 active:scale-95 px-8 py-4 rounded-xl font-bold text-white text-lg shadow-2xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,onClick:c,children:"Connect MetaMask Wallet"})]})})})};function eS(e){let t,{label:r,value:a,status:n}=e,s="";return"boolean"==typeof a?(t=a?"✓ Active":"✗ Inactive",s=a?"text-green-400":"text-orange-400"):"string"==typeof a?(t=a,s="text-gray-200"):null===a?(t="null",s="text-gray-500"):void 0===a?(t="undefined",s="text-gray-500"):(t=String(a),s="text-gray-200"),(0,i.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-black/20 border border-gray-700/30",children:[(0,i.jsx)("span",{className:"text-gray-300 text-sm",children:r}),(0,i.jsx)("span",{className:"font-mono font-semibold text-sm ".concat(s),children:t})]})}function ej(e){let{label:t,value:r,onChange:a,placeholder:n,description:s,icon:l}=e;return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,i.jsx)("span",{className:"text-xl",children:l}),(0,i.jsx)("label",{className:"text-white font-semibold",children:t})]}),(0,i.jsx)("input",{type:"number",className:"input-field w-full px-4 py-3 rounded-lg text-lg font-medium",value:r,onChange:e=>a(e.target.value),placeholder:n}),(0,i.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:s})]})}}},e=>{e.O(0,[655,178,441,255,358],()=>e(e.s=230)),_N_E=e.O()}]);